<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能资源下载站</title>
    
    <!-- 外部资源引用 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- 顶部导航栏 -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand">
                <i class="fas fa-cloud-download-alt logo-icon"></i>
                <span class="logo-text">智能资源下载站</span>
            </div>
            
            <button class="menu-toggle" onclick="toggleNavMenu()" aria-label="切换菜单">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="nav-menu" id="navbarMenu">
                <div class="nav-search">
                    <input type="text" placeholder="搜索资源..." class="nav-search-input" id="resourceSearch">
                    <button class="nav-search-btn" onclick="searchResources()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <ul class="nav-links">
                    <li><a href="#resources" class="nav-link"><i class="fas fa-database"></i> 资源库</a></li>
                    <li><a href="#browser" class="nav-link"><i class="fas fa-globe"></i> 在线浏览器</a></li>
                    <li><a href="#upload" class="nav-link"><i class="fas fa-upload"></i> 上传资源</a></li>
                </ul>
                
                <div class="nav-actions" id="userActions">
                    <button class="btn btn-outline" onclick="openLoginModal()">
                        <i class="fas fa-sign-in-alt"></i> 登录
                    </button>
                    <button class="btn btn-primary" onclick="openRegisterModal()">
                        <i class="fas fa-user-plus"></i> 注册
                    </button>
                </div>
                
                <div class="user-menu" id="userProfile" style="display: none;">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="userName"></div>
                        <div class="user-level" id="userLevel"></div>
                    </div>
                    <div class="user-dropdown">
                        <i class="fas fa-chevron-down"></i>
                        <div class="dropdown-menu">
                        <a href="#userCenter"><i class="fas fa-user"></i> 个人中心</a>
                        <a href="#favorites" onclick="showFavorites()"><i class="fas fa-heart"></i> 我的收藏</a>
                        <a href="#settings"><i class="fas fa-cog"></i> 设置</a>
                        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> 退出登录</a>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- 英雄区域 -->
    <header class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">
                    <span class="highlight">智能资源下载站</span>
                    <br>专业的资源分享平台
                </h1>
                <p class="hero-subtitle">
                    登录即可上传和下载资源，会员等级决定您的下载速度
                </p>
                <div class="hero-actions">
                    <button class="btn btn-large btn-primary" onclick="openLoginModal()">
                        <i class="fas fa-sign-in-alt"></i> 立即登录
                    </button>
                    <button class="btn btn-large btn-outline" onclick="openRegisterModal()">
                        <i class="fas fa-user-plus"></i> 免费注册
                    </button>
                </div>
                <div class="hero-stats">
                    <div class="stat-item">
                        <div class="stat-number">1000+</div>
                        <div class="stat-label">资源文件</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">10k+</div>
                        <div class="stat-label">活跃用户</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">99.9%</div>
                        <div class="stat-label">服务可用性</div>
                    </div>
                </div>
            </div>
            <div class="hero-visual">
                <div class="visual-card">
                    <i class="fas fa-cloud-download-alt globe-icon"></i>
                    <div class="visual-circles">
                        <div class="circle circle-1"></div>
                        <div class="circle circle-2"></div>
                        <div class="circle circle-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 资源库区域 -->
    <section id="resources" class="resources-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">资源库</h2>
                <p class="section-subtitle">浏览和下载各类资源</p>
            </div>
            
            <!-- 资源筛选与搜索区域 -->
            <div class="resource-controls">
                <div class="resource-filters">
                    <button class="filter-btn active" data-filter="all">全部资源</button>
                    <button class="filter-btn" data-filter="document">文档</button>
                    <button class="filter-btn" data-filter="video">视频</button>
                    <button class="filter-btn" data-filter="audio">音频</button>
                    <button class="filter-btn" data-filter="software">软件</button>
                    <button class="filter-btn" data-filter="other">其他</button>
                </div>
                
                <div class="resource-search-container">
                    <input type="text" id="resourceSearch" placeholder="搜索资源、上传者或标签...">
                    <i class="fas fa-search"></i>
                </div>
                
                <div class="resource-sort">
                    <label for="sort">排序方式：</label>
                    <div class="sort-options">
                        <button class="sort-option active" data-sort="newest">
                            <i class="fas fa-clock"></i> 最新上传
                        </button>
                        <button class="sort-option" data-sort="popular">
                            <i class="fas fa-download"></i> 最多下载
                        </button>
                        <button class="sort-option" data-sort="oldest">
                            <i class="fas fa-history"></i> 最早上传
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="resources-grid" id="resourcesGrid">
                <!-- 资源卡片将通过JavaScript动态生成 -->
            </div>
        </div>
    </section>

    <!-- 收藏夹区域 -->
    <section id="favorites" class="favorites-section" style="display: none;">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">我的收藏</h2>
                <p class="section-subtitle">查看和管理您收藏的资源</p>
            </div>
            
            <div class="favorites-controls">
                <div class="favorites-search-container">
                    <input type="text" id="favoritesSearch" placeholder="搜索收藏的资源...">
                    <i class="fas fa-search"></i>
                </div>
                
                <div class="favorites-sort">
                    <label for="favoritesSort">排序方式：</label>
                    <div class="sort-options">
                        <button class="sort-option active" data-sort="newest">
                            <i class="fas fa-clock"></i> 最新收藏
                        </button>
                        <button class="sort-option" data-sort="name">
                            <i class="fas fa-sort-alpha-down"></i> 名称排序
                        </button>
                        <button class="sort-option" data-sort="date">
                            <i class="fas fa-calendar"></i> 上传日期
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="favorites-empty" id="favoritesEmpty" style="display: block;">
                <div class="empty-state">
                    <i class="fas fa-heart-broken"></i>
                    <h3>您还没有收藏任何资源</h3>
                    <p>浏览资源库，点击心形图标收藏您感兴趣的资源</p>
                    <button class="btn btn-primary" onclick="showResources()">
                        <i class="fas fa-database"></i> 浏览资源库
                    </button>
                </div>
            </div>
            
            <div class="resources-grid" id="favoritesGrid">
                <!-- 收藏的资源卡片将通过JavaScript动态生成 -->
            </div>
        </div>
    </section>

    <!-- 在线浏览器区域 -->
    <section id="browser" class="browser-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">在线浏览器</h2>
                <p class="section-subtitle">安全、快速的在线搜索体验</p>
            </div>
            
            <div class="browser-container">
                <div class="browser-toolbar">
                    <button class="browser-btn" onclick="browserSystem.browserBack()" title="后退">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button class="browser-btn" onclick="browserSystem.browserForward()" title="前进">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="browser-btn" onclick="browserSystem.refreshBrowser()" title="刷新">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="browser-btn" onclick="browserSystem.browserHome()" title="主页">
                        <i class="fas fa-home"></i>
                    </button>
                    
                    <div class="browser-url-container">
                        <input type="text" id="browserUrl" placeholder="输入网址或搜索内容..." class="browser-url">
                        <button class="browser-go" onclick="browserSystem.navigate()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 浏览器标签页容器 -->
                <div id="browserTabs" class="browser-tabs"></div>
                
                <div class="browser-content">
                    <div id="iframeLoading" class="browser-loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">加载中...</div>
                    </div>
                    <div class="browser-iframe-container">
                        <iframe id="browserIframe" class="browser-iframe" src="about:blank" frameborder="0" sandbox="allow-scripts allow-popups allow-forms allow-top-navigation-by-user-activation"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 资源上传区域 -->
    <section id="upload" class="upload-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">上传资源</h2>
                <p class="section-subtitle">登录后即可分享您的资源</p>
            </div>
            
            <div class="upload-container">
                <div class="upload-form" id="uploadForm">
                    <div class="form-group">
                        <label for="resourceTitle">资源标题</label>
                        <input type="text" id="resourceTitle" placeholder="请输入资源标题" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceDescription">资源描述</label>
                        <textarea id="resourceDescription" placeholder="请输入资源描述" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceType">资源类型</label>
                        <select id="resourceType" required>
                            <option value="">请选择资源类型</option>
                            <option value="document">文档</option>
                            <option value="video">视频</option>
                            <option value="audio">音频</option>
                            <option value="software">软件</option>
                            <option value="other">其他</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceLink">资源链接</label>
                        <input type="url" id="resourceLink" placeholder="请输入资源下载链接" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceTags">资源标签（用逗号分隔）</label>
                        <input type="text" id="resourceTags" placeholder="如：教程,工具,免费">
                    </div>
                    
                    <div class="upload-actions">
                        <button class="btn btn-primary" onclick="uploadResource()">
                            <i class="fas fa-upload"></i> 上传资源
                        </button>
                    </div>
                </div>
                
                <div class="upload-info">
                    <h3><i class="fas fa-info-circle"></i> 上传须知</h3>
                    <ul>
                        <li>请确保您有权分享该资源</li>
                        <li>资源链接必须是有效的下载地址</li>
                        <li>请勿上传违法、侵权内容</li>
                        <li>上传资源后，管理员会进行审核</li>
                    </ul>
                    
                    <h3><i class="fas fa-tachometer-alt"></i> 会员等级说明</h3>
                    <ul>
                        <li><strong>会员level1</strong>：基础下载速度 (1x)</li>
                        <li><strong>会员level2</strong>：2倍下载速度 (2x)</li>
                        <li><strong>会员level3</strong>：2倍下载速度 (2x) + 10GB云存储空间</li>
                        <li><strong>会员level4</strong>：5倍下载速度 (5x) + 50GB云存储空间 + 优先客服</li>
                        <li><strong>会员level5</strong>：5倍下载速度 (5x) + 100GB云存储空间 + 优先客服 + 无广告体验</li>
                        <li><strong>会员level6</strong>：10倍下载速度 (10x) + 200GB云存储空间 + 优先客服 + 无广告体验 + AI助手基础版</li>
                        <li><strong>会员level7</strong>：10倍下载速度 (10x) + 300GB云存储空间 + 专属客服 + 无广告体验 + AI助手高级版</li>
                        <li><strong>会员level8</strong>：10倍下载速度 (10x) + 500GB云存储空间 + 专属客服 + 无广告体验 + AI助手高级版 + 专属资源</li>
                        <li><strong>会员level9</strong>：10倍下载速度 (10x) + 1TB云存储空间 + 专属客服 + 无广告体验 + AI助手高级版 + 专属资源 + 线下活动</li>
                        <li><strong>会员level10</strong>：10倍下载速度 (10x) + 2TB云存储空间 + 专属客服 + 无广告体验 + AI助手高级版 + 专属资源 + 线下活动 + 定制服务</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- 页脚 -->
    <footer class="footer-section">
        <div class="container">
            <div class="footer-content">
                <div class="footer-about">
                    <div class="footer-logo">
                        <i class="fas fa-cloud-download-alt"></i>
                        <span>智能资源下载站</span>
                    </div>
                    <p>专业的资源分享平台，为用户提供优质的资源下载服务</p>
                </div>
                
                <div class="footer-links">
                    <h4>快速链接</h4>
                    <ul>
                        <li><a href="#resources">资源库</a></li>
                        <li><a href="#browser">在线浏览器</a></li>
                        <li><a href="#upload">上传资源</a></li>
                        <li><a href="#userCenter">个人中心</a></li>
                    </ul>
                </div>
                
                <div class="footer-contact">
                    <h4>联系我们</h4>
                    <ul>
                        <li><i class="fas fa-envelope"></i> contact@downloadsite.com</li>
                        <li><i class="fas fa-phone"></i> 400-123-4567</li>
                        <li><i class="fas fa-map-marker-alt"></i> 北京市朝阳区科技园区</li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-copyright">
                    &copy; 2023 智能资源下载站. 保留所有权利.
                </div>
                <div class="footer-social">
                    <a href="#"><i class="fab fa-weixin"></i></a>
                    <a href="#"><i class="fab fa-weibo"></i></a>
                    <a href="#"><i class="fab fa-qq"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- 登录模态框 -->
    <div class="modal" id="loginModal">
        <div class="modal-overlay" onclick="closeModal('loginModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>用户登录</h3>
                <button class="modal-close" onclick="closeModal('loginModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="loginForm" class="modal-form">
                <div class="form-group">
                    <label for="loginUsername">用户名</label>
                    <input type="text" id="loginUsername" required>
                    <div id="loginUsernameError" class="error-message"></div>
                </div>
                <div class="form-group">
                    <label for="loginPassword">密码</label>
                    <div class="password-input">
                        <input type="password" id="loginPassword" required>
                        <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-options">
                    <label class="checkbox">
                        <input type="checkbox"> 记住密码
                    </label>
                    <a href="#">忘记密码？</a>
                </div>
                <button type="submit" class="btn btn-primary">登录</button>
            </form>
            <div class="modal-footer">
                <p>还没有账号？<a href="#" onclick="openRegisterModal(); closeModal('loginModal')">立即注册</a></p>
            </div>
        </div>
    </div>

    <!-- 注册模态框 -->
    <div class="modal" id="registerModal">
        <div class="modal-overlay" onclick="closeModal('registerModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>用户注册</h3>
                <button class="modal-close" onclick="closeModal('registerModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="registerForm" class="modal-form">
                <div class="form-group">
                    <label for="registerUsername">用户名</label>
                    <input type="text" id="registerUsername" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">邮箱</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">密码</label>
                    <div class="password-input">
                        <input type="password" id="registerPassword" required>
                        <button type="button" class="password-toggle" onclick="togglePassword('registerPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="password-strength" id="passwordStrength"></div>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">确认密码</label>
                    <div class="password-input">
                        <input type="password" id="confirmPassword" required>
                        <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="password-match" id="passwordMatch"></div>
                </div>
                <div class="form-options">
                    <label class="checkbox">
                        <input type="checkbox" required> 我已阅读并同意<a href="#">用户协议</a>和<a href="#">隐私政策</a>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">注册</button>
            </form>
            <div class="modal-footer">
                <p>已有账号？<a href="#" onclick="openLoginModal(); closeModal('registerModal')">立即登录</a></p>
            </div>
        </div>
    </div>

    <!-- 资源详情模态框 -->
    <div class="modal" id="resourceModal">
        <div class="modal-overlay" onclick="closeModal('resourceModal')"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>资源详情</h3>
                <button class="modal-close" onclick="closeModal('resourceModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="resource-details" id="resourceDetails">
                <!-- 资源详情将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>
    
    <!-- 反馈模态框 -->
    <div class="modal" id="feedbackModal">
        <div class="modal-overlay" onclick="closeModal('feedbackModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>用户反馈</h3>
                <button class="modal-close" onclick="closeModal('feedbackModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="feedbackForm">
                    <div class="form-group">
                        <label for="feedbackType">反馈类型</label>
                        <select id="feedbackType" required>
                            <option value="">请选择反馈类型</option>
                            <option value="suggestion">功能建议</option>
                            <option value="bug">问题报告</option>
                            <option value="compliment">表扬鼓励</option>
                            <option value="other">其他</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="feedbackTitle">标题</label>
                        <input type="text" id="feedbackTitle" required placeholder="请输入反馈标题">
                    </div>
                    
                    <div class="form-group">
                        <label for="feedbackContent">详细内容</label>
                        <textarea id="feedbackContent" rows="5" required placeholder="请详细描述您的反馈内容..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="feedbackContact">联系方式（可选）</label>
                        <input type="text" id="feedbackContact" placeholder="邮箱或手机号，方便我们联系您">
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox">
                            <input type="checkbox" required> 我已阅读并同意<a href="#">隐私政策</a>
                        </label>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('feedbackModal')">取消</button>
                        <button type="submit" class="btn btn-primary">提交反馈</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript引用 -->
    <!-- 核心脚本同步加载 -->
    <script src="js/utils.js"></script>
    <script src="js/config.js"></script>
    <script src="js/modules/CoreFramework.js"></script>
    <script src="js/app.js"></script>
    
    <!-- 其他脚本延迟加载 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.1/dist/umd/supabase.min.js" defer></script>
    <script src="js/modules/ModalSystem.js" defer></script>
    <script src="js/modules/ThemeSystem.js" defer></script>
    <script src="js/modules/NavigationSystem.js" defer></script>
    <script src="js/modules/NotificationSystem.js" defer></script>
    <script src="js/modules/UserManagement.js" defer></script>
    <script src="js/modules/MembershipSystem.js" defer></script>
    <script src="js/modules/BrowserSystem.js" defer></script>
    <script src="js/modules/ResourceManager.js" defer></script>
    <script src="js/modules/ResourceCenter.js" defer></script>
    <script src="js/modules/SearchSystem.js" defer></script>
    
    <!-- 未登录状态修复脚本 -->
    <script>
        // 页面完全加载后执行修复逻辑
        window.addEventListener('load', function() {
            // 确保在所有模块加载完成后执行
            setTimeout(function() {
                try {
                    // 清除localStorage中的用户信息（确保未登录状态）
                    localStorage.removeItem('currentUser');
                    
                    // 如果userManagement模块存在，强制设置为未登录状态并更新UI
                    if (typeof window.userManagement !== 'undefined') {
                        window.userManagement.currentUser = null;
                        window.userManagement.updateUserInterface();
                        console.log('已强制设置为未登录状态并更新UI');
                    } else {
                        console.warn('userManagement模块未加载，使用DOM直接修复');
                        // 直接操作DOM修复
                        const userProfile = document.getElementById('userProfile');
                        const loginElements = document.querySelectorAll('.navbar-buttons button');
                        
                        if (userProfile) {
                            userProfile.style.display = 'none';
                            console.log('已隐藏用户资料');
                        }
                        
                        if (loginElements) {
                            loginElements.forEach(button => {
                                button.style.display = 'block';
                            });
                            console.log('已显示登录/注册按钮');
                        }
                    }
                } catch (error) {
                    console.error('未登录状态修复失败:', error);
                }
            }, 1000); // 1秒延迟确保所有模块加载完成
        });
    </script>
    
    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="logo">
                        <i class="fas fa-cloud-download-alt logo-icon"></i>
                        <span class="logo-text">智能资源下载站</span>
                    </div>
                    <p class="footer-description">
                        专业的资源分享平台，为用户提供高质量的资源下载和分享服务
                    </p>
                    <div class="footer-social">
                        <a href="#" class="social-link" aria-label="微信">
                            <i class="fab fa-weixin"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="微博">
                            <i class="fab fa-weibo"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="GitHub">
                            <i class="fab fa-github"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h4>快速导航</h4>
                    <ul>
                        <li><a href="#resources">资源库</a></li>
                        <li><a href="#browser">在线浏览器</a></li>
                        <li><a href="#upload">上传资源</a></li>
                        <li><a href="#userCenter">个人中心</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h4>关于我们</h4>
                    <ul>
                        <li><a href="#">网站介绍</a></li>
                        <li><a href="#">团队成员</a></li>
                        <li><a href="#">联系我们</a></li>
                        <li><a href="#">加入我们</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h4>帮助中心</h4>
                    <ul>
                        <li><a href="#">使用指南</a></li>
                        <li><a href="#">常见问题</a></li>
                        <li><a href="#">用户协议</a></li>
                        <li><a href="#">隐私政策</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-copyright">
                    <p>&copy; 2025 智能资源下载站. 保留所有权利.</p>
                </div>
                <div class="footer-legal">
                    <a href="#">ICP备案号: 1234567890号</a>
                </div>
                <div class="footer-feedback">
                    <button class="btn btn-outline-light btn-sm" onclick="openFeedbackModal()">
                        <i class="fas fa-comment-dots"></i> 用户反馈
                    </button>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>